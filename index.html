<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Flip de Hamb√∫rguer</title>
  <style>
    body {
      font-family: sans-serif;
      text-align: center;
      padding: 40px;
    }
    .score {
      font-size: 2rem;
      margin-bottom: 20px;
    }
    .status {
      font-size: 1.5rem;
      margin-top: 20px;
    }
    .btn-test {
      margin-top: 30px;
      padding: 10px 20px;
      font-size: 1rem;
    }
  </style>
</head>
<body>

  <h1>üçî Flip de Hamb√∫rguer</h1>

  <div class="score" id="pontuacao">Pontua√ß√£o: 0</div>
  <div class="status" id="status">Aguardando primeira batida...</div>

  <button class="btn-test" onclick="GameFlipEngine.simulateFlip(20)">Simular Flip (z=20)</button>

  <script>
    // C√≥digo da engine aqui (ou separado em outro arquivo)
    const GameFlipEngine = (() => {
      let pontuacao = 0;
      let lastFlipTime = 0;
      let proximaBatida = Date.now() + 2000;
      const cooldown = 1000;
      const intervaloBatida = 2000;
      const toleranciaBatida = 300;

      const ranges = {
        perfeito: [18, 25],
        bom: [13, 17.99],
        medio: [9, 12.99],
        fraco: [6, 8.99]
      };

      const listeners = {
        onFlip: [],
        onScoreChange: [],
        onBeat: []
      };

      setInterval(() => {
        proximaBatida = Date.now();
        listeners.onBeat.forEach((cb) => cb(proximaBatida));
      }, intervaloBatida);

      function handleMotion(event) {
        const z = event.accelerationIncludingGravity.z;
        const now = Date.now();

        if (now - lastFlipTime < cooldown) return;

        const distanciaDaBatida = Math.abs(now - proximaBatida);
        const absZ = Math.abs(z);
        let resultado = "Movimento fraco demais.";
        let pontos = 0;

        if (distanciaDaBatida <= toleranciaBatida) {
          if (absZ >= ranges.perfeito[0]) {
            resultado = "Flip Perfeito!";
            pontos = 100;
          } else if (absZ >= ranges.bom[0]) {
            resultado = "Flip Bom!";
            pontos = 70;
          } else if (absZ >= ranges.medio[0]) {
            resultado = "Flip M√©dio.";
            pontos = 40;
          } else if (absZ >= ranges.fraco[0]) {
            resultado = "Flip Fraco.";
            pontos = 10;
          }

          if (pontos > 0) {
            pontuacao += pontos;
            lastFlipTime = now;
            listeners.onScoreChange.forEach((cb) => cb(pontuacao));
          }
        } else {
          resultado = "Fora da batida!";
        }

        listeners.onFlip.forEach((cb) =>
          cb({
            z,
            resultado,
            pontos,
            timestamp: now,
            distanciaDaBatida
          })
        );
      }

      return {
        start() {
          window.addEventListener("devicemotion", handleMotion);
        },
        stop() {
          window.removeEventListener("devicemotion", handleMotion);
        },
        getScore() {
          return pontuacao;
        },
        reset() {
          pontuacao = 0;
          lastFlipTime = 0;
          proximaBatida = Date.now() + intervaloBatida;
        },
        onFlip(callback) {
          listeners.onFlip.push(callback);
        },
        onScoreChange(callback) {
          listeners.onScoreChange.push(callback);
        },
        onBeat(callback) {
          listeners.onBeat.push(callback);
        },
        simulateFlip(zValue) {
          handleMotion({ accelerationIncludingGravity: { z: zValue } });
        },
        getNextBeatTime() {
          return proximaBatida;
        }
      };
    })();

    // UI callbacks
    GameFlipEngine.onFlip((data) => {
      document.getElementById("status").innerText = data.resultado;
      console.log("Flip detectado:", data);
    });

    GameFlipEngine.onScoreChange((score) => {
      document.getElementById("pontuacao").innerText = `Pontua√ß√£o: ${score}`;
    });

    GameFlipEngine.onBeat(() => {
      document.getElementById("status").innerText = "üéµ Batida! Flip agora!";
    });

    GameFlipEngine.start();
  </script>
</body>
</html>
