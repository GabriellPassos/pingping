<!DOCTYPE html>
<html>

<head>
  <title>Leitura do Giroscópio</title>
</head>

<body>
  <h1>Valores do Giroscópio</h1>
  <p>Alpha (Z - Rotação): <span id="alpha">Aguardando...</span></p>
  <p>Beta (X - Inclinação frente/trás): <span id="beta">Aguardando...</span></p>
  <p>Gamma (Y - Inclinação lateral): <span id="gamma">Aguardando...</span></p>
  <div id="efeito-acerto" class="efeito-default" style="height: 20px; width: 80px;"></div>
  <script>
    let alpha;
    let beta;
    let gamma;
    let tempo = 0; // Tempo total acumulado (em segundos)
    let ultimoFrame = performance.now(); // Marca o tempo do último frame
    let inicio = false;
    let tempoRitmoInterno = 0;
    let tempoGatilhoRitmo = 2;
    let betaInicialRitmo = -20;
    let multiplicadorForca = 1;
    let start = true;

    let minimoForcaAcerto = 10;
    let minimoAnguloAcerto = 10;
    let maximoAnguloAcerto = 10;

    const div = document.querySelector('#efeito-acerto')
    
    //PROCESS
    function loop() {
      //CALCULO TEMPO
      const agora = performance.now();
      const delta = (agora - ultimoFrame) / 1000; // Tempo entre frames, em segundos

      tempo += delta; // Incrementa o tempo acumulado

      tempoRitmoInterno = tempoRitmoInterno + delta;

      if (start) {
        let betaAtual = beta;
        console.log(tempoRitmoInterno)
        
        //MOMENTO QUE O JOGADOR IMPULSIONA
        const impulso = calcularForcaSimples(betaInicialRitmo, betaAtual, multiplicadorForca);
        if (betaInicialRitmo > beta) {
          betaInicialRitmo = beta;
        }
        
        div.classList.add('.efeito-default')
        if (tempoRitmoInterno >= tempoGatilhoRitmo) {
          
          if(impulso.forcaCoef > minimoForcaAcerto){
            //ACERTOU
            div.classList.add('.efeito-acerto')
          }
          console.log(`TempoRitmoInterno: ${tempoRitmoInterno}s`);

          console.log(`BetaAtual: ${betaAtual}`);
          console.log(`BetaInicialRitmo: ${betaInicialRitmo}`);
          console.log('Impulso:', impulso);
          

          const trajetoria = calcularPercursoMovimentoLinearVertical(impulso, 1, 1)
          tempoGatilhoRitmo = trajetoria.tempoTotal;
          betaInicialRitmo = betaAtual;
          tempoRitmoInterno = 0;
        }

        
      }

      //console.log(`Tempo: ${tempo.toFixed(2)}s`);

      ultimoFrame = agora;
      requestAnimationFrame(loop); // Próximo frame
    }

    requestAnimationFrame(loop);
    if (window.DeviceOrientationEvent) {
      window.addEventListener("deviceorientation", function (event) {
        document.getElementById("alpha").textContent = event.alpha.toFixed(2);
        document.getElementById("beta").textContent = event.beta.toFixed(2);
        document.getElementById("gamma").textContent = event.gamma.toFixed(2);
        alpha = event.alpha.toFixed(2);
        beta = event.beta.toFixed(2);
        gamma = event.gamma.toFixed(2);
      }, true);
    } else {
      document.body.innerHTML += "<p>Seu navegador não suporta o evento DeviceOrientation.</p>";
    }

    //FISICA

    function calcularPercursoMovimentoLinearVertical(F, m, deltaT, g = 9.8) {
      // Cálculo da velocidade inicial
      const v0 = (F / m) * deltaT;

      // Altura máxima
      const hMax = (v0 ** 2) / (2 * g);

      // Tempo total para voltar ao ponto 0
      const tTotal = (2 * v0) / g;

      // Retorno dos valores em um objeto
      return {
        velocidadeInicial: v0,
        alturaMaxima: hMax,
        tempoTotal: tTotal
      };
    }
    function calcularForcaSimples(betaInicial, betaFinal, constante = 1) {
      const deltaBeta = betaFinal - betaInicial;
      const forcaCoef = Math.abs(deltaBeta) * constante;

      return {
        deltaBeta: deltaBeta,
        forcaCoef: forcaCoef
      };
    }

  </script>
  <style>
  .efeito-acerto{
    background-color: green;
  }
  .efeito-default{
    background-color: red;
  }
  </style>
</body>

</html>