<!DOCTYPE html>
<html>
  <head>
    <title>Leitura do Giroscópio</title>
    <style>
      .efeito-acerto-perfeito {
        background-color: green !important;
      }
      .efeito-acerto-medio {
        background-color: blue !important;
      }
      .efeito-acerto-fraco {
        background-color: yellow !important;
      }
      .efeito-default {
        background-color: red;
      }
    </style>
  </head>
  <body>
    <h1>Valores do Giroscópio</h1>
    <p>Alpha (Z - Rotação): <span id="alpha">Aguardando...</span></p>
    <p>Beta (X - Inclinação frente/trás): <span id="beta">Aguardando...</span></p>
    <p>Gamma (Y - Inclinação lateral): <span id="gamma">Aguardando...</span></p>

    <div id="efeito-acerto" class="efeito-default" style="height: 20px; width: 80px;"></div>

    <p>Contador: <span id="contador-ritmo">Aguardando...</span></p>
    <p>Coeficiente de Força: <span id="coeficiente-forca">Aguardando...</span></p>
    <p id="mensagem"></p>

    <script>
      let alpha = 0, beta = 0, gamma = 0;
      let tempo = 0;
      let ultimoFrame = performance.now();
      let tempoInterno = 0;
      let multiplicadorForca = 1;
      let betaInicial = 0;
      let acertouNesteCiclo = false;

      const minimoForcaAcerto = 10;
      const div = document.querySelector("#efeito-acerto");

      function calcularForcaSimples(inicialBeta, finalBeta, constante = 1) {
        const deltaBeta = finalBeta - inicialBeta;
        const forcaCoef = Math.abs(deltaBeta) * constante;
        return { deltaBeta, forcaCoef };
      }

      function calcularPercursoMovimentoLinearVertical(F, m, deltaT, g = 9.8) {
        const v0 = (F / m) * deltaT;
        const hMax = v0 ** 2 / (2 * g);
        const tTotal = (2 * v0) / g;
        return {
          velocidadeInicial: v0,
          alturaMaxima: hMax,
          tempoTotal: tTotal,
        };
      }

      function resetarClasseVisual() {
        div.className = "efeito-default";
      }

      function aplicarClasseVisual(classe) {
        resetarClasseVisual();
        div.classList.add(classe);
      }

      function movimentoVerticalComBeta(betaInicio, betaFim, limiteAmplitudeBeta) {
        const impulso = calcularForcaSimples(betaInicio, betaFim);
        if (impulso.forcaCoef >= limiteAmplitudeBeta) {
          document.getElementById("coeficiente-forca").textContent = impulso.forcaCoef.toFixed(2);
          const trajetoria = calcularPercursoMovimentoLinearVertical(
            impulso.forcaCoef * multiplicadorForca,
            1,
            1
          );
          return { ...impulso, ...trajetoria };
        } else {
          document.getElementById("coeficiente-forca").textContent = "Baixo";
        }
        return null;
      }

      function loop() {
        const agora = performance.now();
        const delta = (agora - ultimoFrame) / 1000;
        tempo += delta;

        document.getElementById("contador-ritmo").textContent = `${tempoInterno.toFixed(2)}s`;
        document.getElementById("mensagem").textContent = "ACERTE NO TEMPO!";

        if (tempoInterno > 0) {
          tempoInterno -= delta;

          if (!acertouNesteCiclo) {
            const movimentoVertical = movimentoVerticalComBeta(betaInicial, beta, minimoForcaAcerto);
            if (movimentoVertical) {
              if (tempoInterno < 0.3) {
                aplicarClasseVisual("efeito-acerto-perfeito");
              } else if (tempoInterno < 0.5) {
                aplicarClasseVisual("efeito-acerto-medio");
              } else if (tempoInterno < 0.8) {
                aplicarClasseVisual("efeito-acerto-fraco");
              }

              tempoInterno = movimentoVertical.tempoTotal;
              acertouNesteCiclo = true;
            }
          }
        } else {
          const movimentoVertical = movimentoVerticalComBeta(betaInicial, beta, minimoForcaAcerto);
          if (movimentoVertical) {
            tempoInterno = movimentoVertical.tempoTotal;
            betaInicial = beta;
            acertouNesteCiclo = false;
          } else {
            betaInicial = beta;
          }
        }

        ultimoFrame = agora;
        requestAnimationFrame(loop);
      }

      requestAnimationFrame(loop);

      if (window.DeviceOrientationEvent) {
        window.addEventListener(
          "deviceorientation",
          function (event) {
            alpha = parseFloat(event.alpha.toFixed(2));
            beta = parseFloat(event.beta.toFixed(2));
            gamma = parseFloat(event.gamma.toFixed(2));

            document.getElementById("alpha").textContent = alpha;
            document.getElementById("beta").textContent = beta;
            document.getElementById("gamma").textContent = gamma;
          },
          true
        );
      } else {
        document.body.innerHTML += "<p>Seu navegador não suporta o evento DeviceOrientation.</p>";
      }
    </script>
  </body>
</html>
